<% content ||= local_assigns[:content] || local_assigns[:essence_spree_taxon_editor] %>

<div class="content_editor essence_spree_taxon" id="<%= content.dom_id %>" data-content-id="<%= content.id %>">
  <%= content_label(content) %>
  <%= text_field_tag(
    content.form_field_name,
    content.essence.taxon_id,
    id: content.form_field_id,
    class: 'alchemy_selectbox full_width'
  ) %>
</div>

<script>
  $('#<%= content.form_field_id %>').alchemyTaxonSelect({
    placeholder: "<%= Alchemy.t(:search_taxon, scope: 'solidus') %>",
    apiToken: "<%= current_alchemy_user.spree_api_key %>",
    baseUrl: "<%= spree.api_taxons_path %>",
    query_params: <%== content.settings[:query_params].to_json %>,
    <% if content.essence.taxon %>
    initialSelection: {
      id: <%= content.essence.taxon_id %>,
      text: "<%= content.essence.taxon.name %>"
    }
    <% end %>
  })
</script>
